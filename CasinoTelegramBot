import telebot
from telebot import types
import random
import time
import string
import os
from keyboa import Keyboa


token = 'API_Bot_Tocken'  

bot = telebot.TeleBot(token)

ADMIN_USER_ID_Bohdan = 826619403
ADMIN_USER_ID_Anpetro = 728676994
ADMIN_USER_ID_Den = 819889995
ADMIN_USER_IDS = [ADMIN_USER_ID_Bohdan, ADMIN_USER_ID_Anpetro, ADMIN_USER_ID_Den]

if not os.path.exists("balances"):
    os.makedirs("balances")
   

new_users = [] #—Å–ø–∏—Å–æ–∫ –¥–ª—è –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è –Ω–æ–≤–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ (–ø–æ—Ç—ñ—Ä–±–µ–Ω –¥–ª—è –Ω–∞–¥—Å–∏–ª–∞–Ω–Ω—è broadcast –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è)
# –§—É–Ω–∫—Ü—ñ—è –¥–ª—è —á–∏—Ç–∞–Ω–Ω—è –ø—Ä–æ–º–æ–∫–æ–¥—ñ–≤ –∑ —Ñ–∞–π–ª—É
user_balance_data = {}

random.seed(int(time.time()))

possible_values = [1.5, 1.51, 1.52, 1.53, 1.54, 1.55, 1.6, 1.61, 1.62, 1.63, 1.64, 1.65, 1.7, 1.71, 1.72, 1.73, 1.74, 1.75, 1.76, 1.8, 1.85, 1.9, 1.95, 2.0, 5.0]

# –í–∏–±–∏—Ä–∞—î–º–æ –≤–∏–ø–∞–¥–∫–æ–≤–µ —á–∏—Å–ª–æ –∑ –º–æ–∂–ª–∏–≤–∏—Ö –∑–Ω–∞—á–µ–Ω—å




def load_promo_codes():
    promo_codes = {}
    file_path = "promo_codes.txt"

    if os.path.exists(file_path):
        with open(file_path, "r") as file:
            lines = file.readlines()
            for line in lines:
                parts = line.strip().split(',')
                if len(parts) == 2:
                    promo_code, amount = parts
                    promo_codes[promo_code] = int(amount)
    return promo_codes

def load_balance(user_id):
    file_path = f"balances/{user_id}.txt"
    if os.path.exists(file_path):
        with open(file_path, "r") as file:
            return float(file.read())  # –ó—á–∏—Ç—É–≤–∞—Ç–∏ —è–∫ float, –∞ –Ω–µ int
    else:
        return 0.0  # –ó–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º –±–∞–ª–∞–Ω—Å 0.0 –¥–ª—è –Ω–æ–≤–∏—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤

def save_balance(user_id, balance):
    file_path = f"balances/{user_id}.txt"
    with open(file_path, "w") as file:
        file.write(str(balance))

# –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –ø—Ä–æ–º–æ–∫–æ–¥—ñ–≤ –≤ —Ñ–∞–π–ª
def save_promo_codes(promo_codes):
    file_path = "promo_codes.txt"
    with open(file_path, "w") as file:
        for promo_code, amount in promo_codes.items():
            file.write(f"{promo_code},{amount}\n")
#–∫–ª–∞—Å, —è–∫–∏–π –≤—ñ–¥–æ–±—Ä–∞–∂–∞—î —Ç–∞–±–ª–∏—Ü—é –±–∞–∑–∏ –¥–∞–Ω–∏—Ö –¥–ª—è –ø—Ä–æ–º–æ–∫–æ–¥—ñ–≤

#–∫–ª–∞—Å —è–∫–∏–π –≤—ñ–¥–æ–±—Ä–∞–∂–∞—î —Ç–∞–±–ª–∏—Ü—é –±–∞–∑–∏ –¥–∞–Ω–∏—Ö –ø—Ä–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
playing_mines = {}

class Game:
    def __init__(self, user_id, bet):
        self.user_id = user_id
        self.bet = bet
        self.game_board = [[' ' for _ in range(3)] for _ in range(3)]
        self.mines = []
        self.diamonds = []
        self.clicked_cells = set()
        self.game_over = False
        self.current_win = 0
        self.discovered_diamonds = set()  # –ó–±–µ—Ä—ñ–≥–∞—î –∞–ª–º–∞–∑–∏, —è–∫—ñ –≤–∂–µ –±—É–ª–∏ –≤–∏—è–≤–ª–µ–Ω—ñ

    def generate_mines_and_diamonds(self):
        self.mines = random.sample(range(9), 2)
        self.diamonds = [i for i in range(9) if i not in self.mines]

    def create_game_markup(self):
        markup = types.InlineKeyboardMarkup(row_width=3)
        for i in range(3):
            row_buttons = []
            for j in range(3):
                button_text = self.game_board[i][j]
                row_buttons.append(types.InlineKeyboardButton(button_text, callback_data=f'{i}_{j}'))
            markup.add(*row_buttons)
        markup.add(types.InlineKeyboardButton("–ó–∞–±—Ä–∞—Ç–∏!", callback_data="claim"))
        return markup
    
@bot.message_handler(commands=['admin'])
def admin_panel(message):
    user_id = message.from_user.id

    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —á–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –º–∞—î –ø—Ä–∞–≤–∞ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞
    if user_id in ADMIN_USER_IDS:
        # –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –∫–ª–∞–≤—ñ–∞—Ç—É—Ä–∏ –¥–ª—è –∞–¥–º—ñ–Ω-–ø–∞–Ω–µ–ª—ñ
        admin_markup = types.ReplyKeyboardMarkup(resize_keyboard=True)
        item_balance = types.KeyboardButton("–í–∏–¥–∞—Ç–∏ –±–∞–ª–∞–Ω—Å")
        item_back = types.KeyboardButton("–ù–∞–∑–∞–¥")
        item_feedback = types.KeyboardButton("–í—ñ–¥–ø–æ–≤—ñ—Å—Ç–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–µ–≤—ñ")
        item_ads = types.KeyboardButton("–†–µ–∫–ª–∞–º–∞")
        item_users = types.KeyboardButton("–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ")
        admin_markup.row(item_balance, item_back,item_feedback,item_ads, item_users)

        # –í—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –∑ –∫–ª–∞–≤—ñ–∞—Ç—É—Ä–æ—é
        bot.send_message(message.chat.id, "–í–∏–±–µ—Ä—ñ—Ç—å –¥—ñ—é ‚Üì", reply_markup=admin_markup)
    else:
        bot.send_message(message.chat.id, "–í–∏ –Ω–µ –º–∞—î—Ç–µ –ø—Ä–∞–≤ –¥–ª—è –¥–æ—Å—Ç—É–ø—É –¥–æ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–∏–≤–Ω–æ—ó –ø–∞–Ω–µ–ª—ñ.")

@bot.message_handler(func=lambda message: message.text == "–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ")
def uesrs(message):
    user_id = message.from_user.id

    users_markup = types.ReplyKeyboardMarkup(resize_keyboard=True)
    all_users = types.KeyboardButton("–ö–æ—Ä–∏—Å—É—Ç–≤–∞—á—ñ –≤ –º–µ—Ä–µ–∂—ñ")
    block_users = types.KeyboardButton("–ó–∞–±–ª–æ–∫—É–≤–∞—Ç–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞")
    unblock_user = types.KeyboardButton("–†–æ–∑–±–ª–æ–∫—É–≤–∞—Ç–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞")
    step_back = types.KeyboardButton("–ùa–∑–∞–¥")
    users_markup.add(all_users, block_users,unblock_user, step_back)
    # –í—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –∑ –∫–ª–∞–≤—ñ–∞—Ç—É—Ä–æ—é "–ù–∞–∑–∞–¥" —ñ –≤–∏–¥–∞–ª–µ–Ω–Ω—è–º —É—Å—ñ—Ö —ñ–Ω—à–∏—Ö –∫–Ω–æ–ø–æ–∫
    bot.send_message(user_id, "–í–∏–±–µ—Ä—ñ—Ç—å –¥—ñ—é ‚Üì", reply_markup=users_markup)

@bot.message_handler(func=lambda message: message.text == "–ö–æ—Ä–∏—Å—É—Ç–≤–∞—á—ñ –≤ –º–µ—Ä–µ–∂—ñ")
def users_online(message):
    admin_id = message.from_user.id
    counter_users = 0
    for users_id in new_users:
        balance = load_balance(users_id)
        if users_id in ADMIN_USER_IDS:
            bot.send_message(admin_id, f"–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á: {users_id}, –±–∞–ª–∞–Ω—Å: {balance} - –ê–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä")
        else:
            bot.send_message(admin_id, f"–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á: {users_id}, –±–∞–ª–∞–Ω—Å: {balance}")
        counter_users += 1
    bot.send_message(admin_id, f"–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ –≤ –º–µ—Ä–µ–∂—ñ: {counter_users}")

@bot.message_handler(func=lambda message: message.text == "–ó–∞–±–ª–æ–∫—É–≤–∞—Ç–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞")
def block_uesr_info(message):
    admin_id = message.from_user.id
    bot.send_message(admin_id, "–í–≤–µ–¥—ñ—Ç—å —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ —ñ –ø—Ä–∏—á–∏–Ω—É –±–∞–Ω—É: ")
    bot.register_next_step_handler(message, block_user)

blocked_user = "blocked_users.txt" # —Ñ–∞–π–ª –∑ –∑–∞–±–ª–æ–∫–æ–≤–∞–Ω–∏–º–∏ –∫–æ—Ä–∏—Å—É—Ç–≤–∞—á–∞–º–∏
def block_user(message):
    try:
        # –û—Ç—Ä–∏–º–∞–Ω–Ω—è –≤–≤–µ–¥–µ–Ω–æ–≥–æ —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä–∞ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ —ñ –ø—Ä–∏—á–∏–Ω–∏ –±–∞–Ω—É
        user_id, reason = message.text.split(" ", 1)
   
        with open(blocked_user, "a") as file:
            file.write(f"User ID: {user_id}, Reason: {reason}\n")

        # –í—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ —É—Å–ø—ñ—à–Ω–µ –±–ª–æ–∫—É–≤–∞–Ω–Ω—è
        bot.send_message(message.chat.id, f"–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –∑ ID {user_id} –∑–∞–±–ª–æ–∫–æ–≤–∞–Ω–æ –∑ –ø—Ä–∏—á–∏–Ω–æ—é: {reason}")
        bot.send_message(user_id, f"–í–∞—Å –∑–∞–±–ª–æ–∫–æ–≤–∞–Ω–æ –∑ –ø—Ä–∏—á–∏–Ω–æ—é: {reason}")
    except ValueError:
        bot.send_message(message.chat.id, "–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∏–π —Ñ–æ—Ä–º–∞—Ç –≤–≤–µ–¥–µ–Ω–Ω—è. –í–≤–µ–¥—ñ—Ç—å —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ —ñ –ø—Ä–∏—á–∏–Ω—É —á–µ—Ä–µ–∑ –ø—Ä–æ–±—ñ–ª.")


@bot.message_handler(func=lambda message: message.text == "–†–æ–∑–±–ª–æ–∫—É–≤–∞—Ç–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞")
def unblock_user_info(message):
    admin_id = message.from_user.id
    bot.send_message(admin_id, "–í–≤–µ–¥—ñ—Ç—å —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞, —è–∫–æ–≥–æ –≤–∏ —Ö–æ—á–µ—Ç–µ —Ä–æ–∑–±–ª–æ–∫—É–≤–∞—Ç–∏: ")
    bot.register_next_step_handler(message, unblock_user)


@bot.message_handler(func=lambda message: message.text == "–ùa–∑–∞–¥")
def go_back_admin(message):
    user_id = message.from_user.id

    # –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –∫–ª–∞–≤—ñ–∞—Ç—É—Ä–∏ –¥–ª—è –≤–∏–¥–∞–ª–µ–Ω–Ω—è —É—Å—ñ—Ö —ñ–Ω—à–∏—Ö –∫–Ω–æ–ø–æ–∫ —ñ –¥–æ–¥–∞–≤–∞–Ω–Ω—è –∫–Ω–æ–ø–∫–∏ "–û—Å–æ–±–∏—Å—Ç–∏–π –∫–∞–±—ñ–Ω–µ—Ç"
    back_markup = types.ReplyKeyboardMarkup(resize_keyboard=True)
    item_balance = types.KeyboardButton("–í–∏–¥–∞—Ç–∏ –±–∞–ª–∞–Ω—Å")
    item_back = types.KeyboardButton("–ù–∞–∑–∞–¥")
    item_feedback = types.KeyboardButton("–í—ñ–¥–ø–æ–≤—ñ—Å—Ç–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–µ–≤—ñ")
    item_ads = types.KeyboardButton("–†–µ–∫–ª–∞–º–∞")
    item_users = types.KeyboardButton("–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ")
    back_markup.row(item_balance, item_back,item_feedback,item_ads, item_users)

    # –í—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –∑ –∫–ª–∞–≤—ñ–∞—Ç—É—Ä–æ—é "–ù–∞–∑–∞–¥" —ñ –≤–∏–¥–∞–ª–µ–Ω–Ω—è–º —É—Å—ñ—Ö —ñ–Ω—à–∏—Ö –∫–Ω–æ–ø–æ–∫
    bot.send_message(user_id, "–í–∏ –ø–æ–≤–µ—Ä–Ω—É–ª–∏—Å—è –Ω–∞–∑–∞–¥.", reply_markup=back_markup)





def unblock_user(message):
    try:
        # –û—Ç—Ä–∏–º–∞–Ω–Ω—è –≤–≤–µ–¥–µ–Ω–æ–≥–æ —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä–∞ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
        user_id = message.text

        # –í—ñ–¥–∫—Ä–∏–≤–∞—î–º–æ —Ñ–∞–π–ª –±–ª–æ–∫—É–≤–∞–Ω—å —ñ —á–∏—Ç–∞—î–º–æ –π–æ–≥–æ —Ä—è–¥–æ–∫ –∑–∞ —Ä—è–¥–∫–æ–º
        with open("blocked_users.txt", "r") as file:
            lines = file.readlines()

        # –°—Ç–≤–æ—Ä—é—î–º–æ –Ω–æ–≤–∏–π —Ñ–∞–π–ª –±–µ–∑ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –ø—Ä–æ —Ä–æ–∑–±–ª–æ–∫–æ–≤–∞–Ω–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
        with open("blocked_users.txt", "w") as file:
            for line in lines:
                if not line.startswith(f"User ID: {user_id}"):
                    file.write(line)

        # –í—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ —É—Å–ø—ñ—à–Ω–µ —Ä–æ–∑–±–ª–æ–∫—É–≤–∞–Ω–Ω—è
        bot.send_message(message.chat.id, f"–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –∑ ID {user_id} —Ä–æ–∑–±–ª–æ–∫–æ–≤–∞–Ω–æ.")
        bot.send_message(user_id, "–í–∞—Å —Ä–æ–∑–±–ª–æ–∫–æ–≤–∞–Ω–æ –≤ –±–æ—Ç—ñ.")
    except ValueError:
        bot.send_message(message.chat.id, "–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∏–π —Ñ–æ—Ä–º–∞—Ç –≤–≤–µ–¥–µ–Ω–Ω—è. –í–≤–µ–¥—ñ—Ç—å —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞, —è–∫–æ–≥–æ –≤–∏ —Ö–æ—á–µ—Ç–µ —Ä–æ–∑–±–ª–æ–∫—É–≤–∞—Ç–∏.")

# –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –º–∞—Å–æ–≤–æ—ó —Ä–æ–∑—Å–∏–ª–∫–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å —É—Å—ñ–º –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞–º
def send_broadcast_message(message_text):
    for user_id in new_users:
        bot.send_message(user_id, message_text)

# –û–±—Ä–æ–±–Ω–∏–∫ –∫–Ω–æ–ø–∫–∏ "–†–µ–∫–ª–∞–º–∞"
@bot.message_handler(func=lambda message: message.text == "–†–µ–∫–ª–∞–º–∞")
def advertisement(message):
    user_id = message.chat.id
    if user_id in ADMIN_USER_IDS:
        bot.send_message(user_id, "–í–≤–µ–¥—ñ—Ç—å —Ä–µ–∫–ª–∞–º—É, —è–∫—É –≤–∏ —Ö–æ—á–µ—Ç–µ –Ω–∞–¥—ñ—Å–ª–∞—Ç–∏:")
        bot.register_next_step_handler(message, send_advertisement)

def send_advertisement(message):
    user_id = message.chat.id
    advertisement_text = message.text
    send_broadcast_message(advertisement_text)
    bot.send_message(user_id, "–†–µ–∫–ª–∞–º–∞ —É—Å–ø—ñ—à–Ω–æ –Ω–∞–¥—ñ—Å–ª–∞–Ω–∞")


# –û–±—Ä–æ–±–Ω–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ "–í—ñ–¥–ø–æ–≤—ñ—Å—Ç–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–µ–≤—ñ"
@bot.message_handler(func=lambda message: message.text == "–í—ñ–¥–ø–æ–≤—ñ—Å—Ç–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–µ–≤—ñ")
def reply_to_user_button(message):
    user_id = message.from_user.id
    # –í—ñ–¥–ø—Ä–∞–≤–ª—è—î–º–æ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –¥–ª—è –∑–∞–ø–∏—Ç—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –≤—ñ–¥ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞
    bot.send_message(ADMIN_USER_ID_Bohdan, "–í–≤–µ–¥—ñ—Ç—å —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ —Ç–∞ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è, —è–∫–µ –≤–∏ —Ö–æ—á–µ—Ç–µ –Ω–∞–¥—ñ—Å–ª–∞—Ç–∏. –ù–∞–ø—Ä–∏–∫–ª–∞–¥, '12345 –í–∞—à–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è'")
    bot.register_next_step_handler(message, forward_message_to_user)

# –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –ø–µ—Ä–µ—Å–∏–ª–∞–Ω–Ω—è –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–µ–≤—ñ
def forward_message_to_user(message):
    admin_id = message.chat.id
    input_text = message.text.strip()
    parts = input_text.split(' ', 1)  # –†–æ–∑–¥—ñ–ª—è—î–º–æ –≤–≤–µ–¥–µ–Ω–∏–π —Ç–µ–∫—Å—Ç –Ω–∞ —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ —Ç–∞ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
    if len(parts) == 2:
        user_id, reply_text = parts
        bot.send_message(int(user_id), f'–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –≤—ñ–¥ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞:\n\n{reply_text}')
        bot.send_message(admin_id, f'–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –Ω–∞–¥—ñ—Å–ª–∞–Ω–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—É {user_id}')
    else:
        bot.send_message(admin_id, "–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∏–π —Ñ–æ—Ä–º–∞—Ç –≤–≤–µ–¥–µ–Ω–Ω—è. –í–≤–µ–¥—ñ—Ç—å —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ —Ç–∞ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è —á–µ—Ä–µ–∑ –ø—Ä–æ–±—ñ–ª.")

@bot.message_handler(func=lambda message: message.text == "–í–∏–¥–∞—Ç–∏ –±–∞–ª–∞–Ω—Å")
def issue_balance(message):
    user_id = message.from_user.id
    # –í—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –∑ —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è–º–∏ —â–æ–¥–æ –≤–≤–µ–¥–µ–Ω–Ω—è –∫–æ–º–∞–Ω–¥–∏
    instructions = "–î–ª—è –ø–æ–ø–æ–≤–Ω–µ–Ω–Ω—è –±–∞–ª–∞–Ω—Å—É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –≤–≤–µ–¥—ñ—Ç—å:\n/give_balance user_id +-=—Å—É–º–º–∞"
    bot.send_message(user_id, instructions)
# ...

@bot.message_handler(func=lambda message: message.text == "–ù–∞–∑–∞–¥")
def go_back(message):
    user_id = message.from_user.id

    # –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –∫–ª–∞–≤—ñ–∞—Ç—É—Ä–∏ –¥–ª—è –≤–∏–¥–∞–ª–µ–Ω–Ω—è —É—Å—ñ—Ö —ñ–Ω—à–∏—Ö –∫–Ω–æ–ø–æ–∫ —ñ –¥–æ–¥–∞–≤–∞–Ω–Ω—è –∫–Ω–æ–ø–∫–∏ "–û—Å–æ–±–∏—Å—Ç–∏–π –∫–∞–±—ñ–Ω–µ—Ç"
    back_markup = types.ReplyKeyboardMarkup(resize_keyboard=True)
    item_profile = types.KeyboardButton("–û—Å–æ–±–∏—Å—Ç–∏–π –∫–∞–±—ñ–Ω–µ—Ç")
    item_promo_code = types.KeyboardButton("–ü—Ä–æ–º–æ–∫–æ–¥")
    item_available_games = types.KeyboardButton("–Ü–≥—Ä–∏")
    back_markup.add(item_profile, item_promo_code, item_available_games)
    # –í—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –∑ –∫–ª–∞–≤—ñ–∞—Ç—É—Ä–æ—é "–ù–∞–∑–∞–¥" —ñ –≤–∏–¥–∞–ª–µ–Ω–Ω—è–º —É—Å—ñ—Ö —ñ–Ω—à–∏—Ö –∫–Ω–æ–ø–æ–∫
    bot.send_message(user_id, "–í–∏ –ø–æ–≤–µ—Ä–Ω—É–ª–∏—Å—è –Ω–∞–∑–∞–¥.", reply_markup=back_markup)




@bot.message_handler(commands=['give_balance'])
def give_balance(message):
    user_id = message.from_user.id

    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —á–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –º–∞—î –ø—Ä–∞–≤–∞ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞
    if user_id in ADMIN_USER_IDS:
        # –†–æ–∑–¥—ñ–ª–µ–Ω–Ω—è —Ç–µ–∫—Å—Ç—É –∫–æ–º–∞–Ω–¥–∏ –Ω–∞ –∞—Ä–≥—É–º–µ–Ω—Ç–∏
        args = message.text.split()
    
        if len(args) != 3 or (args[2][0] not in ['+', '-', '=']):
            bot.send_message(user_id, "–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∏–π —Ñ–æ—Ä–º–∞—Ç –∫–æ–º–∞–Ω–¥–∏. –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ: /give_balance user_id +—Å—É–º–º–∞ (–∞–±–æ -—Å—É–º–º–∞, =—Å—É–º–º–∞)")
        else:
            try:
                target_user_id = int(args[1])
                operation = args[2][0]  # –û—Ç—Ä–∏–º—É—î–º–æ –∑–Ω–∞–∫ +, - –∞–±–æ =
                amount = int(args[2][1:])  # –û—Ç—Ä–∏–º—É—î–º–æ —Å—É–º—É –±–µ–∑ –∑–Ω–∞–∫—É

                if operation == '+':
                    # –î–æ–¥–∞–≤–∞–Ω–Ω—è —Å—É–º–∏ –¥–æ –±–∞–ª–∞–Ω—Å—É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
                    current_balance = load_balance(target_user_id)
                    save_balance(target_user_id, current_balance + amount)
                    bot.send_message(user_id, f"–ë–∞–ª–∞–Ω—Å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ {target_user_id} –∑–±—ñ–ª—å—à–µ–Ω–æ –Ω–∞ {amount}.")
                elif operation == '-':
                    # –í—ñ–¥–Ω—ñ–º–∞–Ω–Ω—è —Å—É–º–∏ –≤—ñ–¥ –±–∞–ª–∞–Ω—Å—É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
                    current_balance = load_balance(target_user_id)
                    if current_balance >= amount:
                        save_balance(target_user_id, current_balance - amount)
                        bot.send_message(user_id, f"–ë–∞–ª–∞–Ω—Å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ {target_user_id} –∑–º–µ–Ω—à–µ–Ω–æ –Ω–∞ {amount}.")
                    else:
                        bot.send_message(user_id, f"–£ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –Ω–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ –∫–æ—à—Ç—ñ–≤ –¥–ª—è –∑–º–µ–Ω—à–µ–Ω–Ω—è –±–∞–ª–∞–Ω—Å—É –Ω–∞ {amount}.")
                elif operation == '=':
                    # –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è —Ç–æ—á–Ω–æ–≥–æ –±–∞–ª–∞–Ω—Å—É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
                    save_balance(target_user_id, amount)
                    bot.send_message(user_id, f"–ë–∞–ª–∞–Ω—Å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ {target_user_id} –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –Ω–∞ {amount}.")
            except ValueError:
                bot.send_message(user_id, "–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∏–π —Ñ–æ—Ä–º–∞—Ç –∫–æ–º–∞–Ω–¥–∏. –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ: /give_balance user_id +—Å—É–º–º–∞ (–∞–±–æ -—Å—É–º–º–∞, =—Å—É–º–º–∞)")
    else:
        bot.send_message(message.chat.id, "–í–∏ –Ω–µ –º–∞—î—Ç–µ –ø—Ä–∞–≤ –¥–ª—è –≤–∏–∫–æ–Ω–∞–Ω–Ω—è —Ü—ñ—î—ó –∫–æ–º–∞–Ω–¥–∏.")



# ...

promo_codes = load_promo_codes()  # –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –ø—Ä–æ–º–æ–∫–æ–¥—ñ–≤ –∑ —Ñ–∞–π–ª—É –ø—Ä–∏ –∑–∞–ø—É—Å–∫—É –±–æ—Ç–∞

@bot.message_handler(commands=['create_promo_code'])
def create_promo_code(message):
    user_id = message.from_user.id

    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —á–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –º–∞—î –ø—Ä–∞–≤–∞ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞
    if user_id in ADMIN_USER_IDS:
        args = message.text.split()

        if len(args) != 2:
            bot.send_message(user_id, "–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∏–π —Ñ–æ—Ä–º–∞—Ç –∫–æ–º–∞–Ω–¥–∏. –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ: /create_promo_code —Å—É–º–º–∞")
        else:
            try:
                amount = int(args[1])
                if amount <= 0:
                    bot.send_message(user_id, "–°—É–º–∞ –ø—Ä–æ–º–æ–∫–æ–¥—É –ø–æ–≤–∏–Ω–Ω–∞ –±—É—Ç–∏ –±—ñ–ª—å—à–µ –Ω—É–ª—è.")
                else:
                    promo_code = generate_promo_code()
                    promo_codes[promo_code] = amount
                    save_promo_codes(promo_codes)  # –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è –ø—Ä–æ–º–æ–∫–æ–¥—ñ–≤ —É —Ñ–∞–π–ª

                    bot.send_message(user_id, f"–°—Ç–≤–æ—Ä–µ–Ω–æ –Ω–æ–≤–∏–π –ø—Ä–æ–º–æ–∫–æ–¥: {promo_code} –Ω–∞ —Å—É–º—É {amount}.")
            except ValueError:
                bot.send_message(user_id, "–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∏–π —Ñ–æ—Ä–º–∞—Ç –∫–æ–º–∞–Ω–¥–∏. –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ: /create_promo_code —Å—É–º–º–∞")
    else:
        bot.send_message(message.chat.id, "–í–∏ –Ω–µ –º–∞—î—Ç–µ –ø—Ä–∞–≤ –¥–ª—è –≤–∏–∫–æ–Ω–∞–Ω–Ω—è —Ü—ñ—î—ó –∫–æ–º–∞–Ω–¥–∏.")



@bot.message_handler(commands=['check_promo_code'])
def check_promo_code(message):
    user_id = message.from_user.id
    args = message.text.split()

    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —á–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –º–∞—î –ø—Ä–∞–≤–∞ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞
    if user_id in ADMIN_USER_IDS:
        if len(args) != 2:
            bot.send_message(user_id, "–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∏–π —Ñ–æ—Ä–º–∞—Ç –∫–æ–º–∞–Ω–¥–∏. –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ: /check_promo_code promo_code")
        else:
            promo_code = args[1]

            if promo_code in promo_codes:
                amount = promo_codes[promo_code]
                bot.send_message(user_id, f"–ü—Ä–æ–º–æ–∫–æ–¥ {promo_code} –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î —Å—É–º—ñ {amount}.")
            else:
                bot.send_message(user_id, f"–ü—Ä–æ–º–æ–∫–æ–¥ {promo_code} –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ.")
    else:
        bot.send_message(message.chat.id, "–í–∏ –Ω–µ –º–∞—î—Ç–µ –ø—Ä–∞–≤ –¥–ª—è –≤–∏–∫–æ–Ω–∞–Ω–Ω—è —Ü—ñ—î—ó –∫–æ–º–∞–Ω–¥–∏.")


def generate_promo_code(length=6):
    characters = string.ascii_letters + string.digits
    return ''.join(random.choice(characters) for _ in range(length))

# –ó–±–µ—Ä—ñ–≥–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö –ø—Ä–æ –≥—Ä–∏ –∫–æ–∂–Ω–æ–≥–æ –≥—Ä–∞–≤—Ü—è

@bot.message_handler(commands=['bomb'])
def bomb(message):
    user_id = message.from_user.id

    if user_id in playing_mines:
        bot.send_message(message.chat.id, "–í–∏ –≤–∂–µ –≥—Ä–∞—î—Ç–µ –≤ –≥—Ä—É –∑ –º—ñ–Ω–∞–º–∏.")
        return
    
    try:
        bet = int(message.text.split(' ')[1])
        if bet > 1:
            balance = load_balance(user_id)  # –ó–∞–º—ñ—Å—Ç—å —Ü—å–æ–≥–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –≤–∞—à—É —Ñ—É–Ω–∫—Ü—ñ—é –¥–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –±–∞–ª–∞–Ω—Å—É
            if balance >= bet:
                balance -= bet
                # –ó–±–µ—Ä—ñ–≥–∞–Ω–Ω—è –±–∞–ª–∞–Ω—Å—É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
                save_balance(user_id, balance)
                
                # –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –Ω–æ–≤–æ—ó –≥—Ä–∏ –¥–ª—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
                game = Game(user_id, bet)
                game.generate_mines_and_diamonds()
                playing_mines[user_id] = {"game_started": True, "game": game}
                
                markup = game.create_game_markup()
                bot.send_message(message.chat.id, f"–ì—Ä–∞ –ø–æ—á–∞–ª–∞—Å—è! –í–∞—à–∞ –ø–æ—Ç–æ—á–Ω–∞ —Å—Ç–∞–≤–∫–∞: {bet}. –°–ø—Ä–æ–±—É–π—Ç–µ –≤—ñ–¥–∫—Ä–∏—Ç–∏ –∞–ª–º–∞–∑–∏, —É–Ω–∏–∫–∞–π—Ç–µ –º—ñ–Ω.", reply_markup=markup)
            else:
                bot.send_message(message.chat.id, "–£ –≤–∞—Å –Ω–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ –∫–æ—à—Ç—ñ–≤ –¥–ª—è —Ü—ñ—î—ó —Å—Ç–∞–≤–∫–∏.")
        else:
            bot.send_message(message.chat.id, "–°—Ç–∞–≤–∫–∞ –ø–æ–≤–∏–Ω–Ω–∞ –±—É—Ç–∏ –±—ñ–ª—å—à–µ 1 —ñ —Ü—ñ–ª–∏–º —á–∏—Å–ª–æ–º.")
    except (IndexError, ValueError):
        bot.send_message(message.chat.id, "–í–≤–µ–¥—ñ—Ç—å –∫–æ–º–∞–Ω–¥—É —É —Ñ–æ—Ä–º–∞—Ç—ñ /bomb —Å—É–º–º–∞ (–¥–µ —Å—É–º–º–∞ - —Ü–µ –≤–∞—à–∞ —Å—Ç–∞–≤–∫–∞).")

# –û–Ω–æ–≤–ª–µ–Ω–∏–π –æ–±—Ä–æ–±–Ω–∏–∫ –Ω–∞—Ç–∏—Å–∫–∞–Ω–Ω—è –Ω–∞ –∫–ª–∞–≤—ñ—à—É –ø–æ–ª—è –≥—Ä–∏
@bot.callback_query_handler(func=lambda call: playing_mines.get(call.from_user.id) is not None)
def update_board(call):
    user_id = call.from_user.id
    game_data = playing_mines.get(user_id)

    if not game_data:
        return
    
    if game_data["game"].game_over:
        return

    if call.data == "claim":
        if not game_data["game"].game_over:
            balance = load_balance(user_id)  
            balance += game_data["game"].current_win
            # –ó–±–µ—Ä—ñ–≥–∞–Ω–Ω—è –Ω–æ–≤–æ–≥–æ –±–∞–ª–∞–Ω—Å—É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
            save_balance(user_id, balance)
            
            bot.edit_message_text(chat_id=call.message.chat.id, message_id=call.message.message_id,
                                  text=f"–í–∏ –∑–∞–±—Ä–∞–ª–∏ {game_data['game'].current_win} –≥—Ä–Ω. –ì—Ä–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞.")
            game_data["game"].game_over = True

            playing_mines.pop(user_id, None)
    else:
        row, col = map(int, call.data.split('_'))
        cell_id = row * 3 + col

        if cell_id in game_data["game"].clicked_cells:
            return  # –Ü–≥–Ω–æ—Ä—É–≤–∞—Ç–∏ –∫–ª—ñ—Ç–∏–Ω–∏, —è–∫—ñ –≤–∂–µ –±—É–ª–∏ –Ω–∞—Ç–∏—Å–Ω—É—Ç—ñ

        game = game_data["game"]

        if cell_id in game.mines:
            game.game_board[row][col] = 'üí£'
            markup = game.create_game_markup()
            bot.edit_message_text(chat_id=call.message.chat.id, message_id=call.message.message_id,
                                  text="–ì—Ä–∞ –∑–∞–≤–µ—Ä—à–∏–ª–∞—Å—è. –í–∏ –ø—Ä–æ–≥—Ä–∞–ª–∏! üí£", reply_markup=markup)
            game.game_over = True

            playing_mines.pop(user_id, None)
        elif cell_id in game.diamonds:
            if cell_id not in game.discovered_diamonds:  # –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏, —á–∏ –∞–ª–º–∞–∑ –≤–∂–µ –±—É–≤ –≤–∏—è–≤–ª–µ–Ω–∏–π
                game.game_board[row][col] = 'üíé'
                markup = game.create_game_markup()
                game.current_win += 0.5 * game.bet
                bot.edit_message_text(chat_id=call.message.chat.id, message_id=call.message.message_id,
                                      text=f"–ê–ª–º–∞–∑ –≤–∏—è–≤–ª–µ–Ω–æ! –í–∞—à –≤–∏–≥—Ä–∞—à: {game.current_win} –≥—Ä–Ω. –í–∞—à–∞ –ø–æ—Ç–æ—á–Ω–∞ —Å—Ç–∞–≤–∫–∞: {game.bet}.", reply_markup=markup)
                game.discovered_diamonds.add(cell_id)  # –î–æ–¥–∞—Ç–∏ –∞–ª–º–∞–∑ –¥–æ —Å–ø–∏—Å–∫—É –≤–∏—è–≤–ª–µ–Ω–∏—Ö
            

def is_user_blocked(user_id): #–ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ —á–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –∑–∞–±–ª–æ–∫–æ–≤–∞–Ω–∏–π
    with open(blocked_user, "r") as file:
        lines = file.readlines()
        for line in lines:
            if f"User ID: {user_id}" in line:
                return True
    return False



class Player:
    def __init__(self, user_id):
        self.user_id = user_id
        self.hand = []
        self.is_playing = False
        self.bet = 0
        self.current_win = 0

class BlackjackGame:
    def __init__(self):
        self.games = {}  # –ó–±–µ—Ä—ñ–≥–∞–π—Ç–µ –≥—Ä–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –≥—Ä–∞–≤—Ü—ñ–≤
        self.deck = self.get_deck()
        self.dealer_hand = []

    def get_deck(self):
        suits = ['–ß–µ—Ä–≤–∏', '–ë—É–±–Ω–∏', '–•—Ä–µ—Å—Ç–∏', '–ü—ñ–∫–∏']
        ranks = ['2', '3', '4', '5', '6', '7', '8', '9', '10', '–í–∞–ª–µ—Ç', '–î–∞–º–∞', '–ö–æ—Ä–æ–ª—å', '–¢—É–∑']
        return [{'rank': rank, 'suit': suit} for rank in ranks for suit in suits]

    def create_game(self, user_id):
        if user_id not in self.games:
            self.games[user_id] = {
                "players": {},
                "dealer_hand": [],
                "current_player": None
            }

    def get_game(self, user_id):
        return self.games.get(user_id)

    def deal_initial_cards(self, game):
        for player in game["players"].values():
            if not player.is_playing:
                continue
            player.hand = [random.choice(self.deck), random.choice(self.deck)]
        game["dealer_hand"] = [random.choice(self.deck), random.choice(self.deck)]

    def calculate_hand_value(self, hand):
        values = {'2': 2, '3': 3, '4': 4, '5': 5, '6': 6, '7': 7, '8': 8, '9': 9, '10': 10, '–í–∞–ª–µ—Ç': 10, '–î–∞–º–∞': 10, '–ö–æ—Ä–æ–ª—å': 10, '–¢—É–∑': 11}
        total_value = sum([values[card['rank']] for card in hand])
        aces = [card for card in hand if card['rank'] == '–¢—É–∑']
        while total_value > 21 and aces:
            total_value -= 10
            aces.pop()
        return total_value

game = BlackjackGame()

@bot.message_handler(commands=['blackjack'])
def start_game(message):
    user_id = message.from_user.id
    game.create_game(user_id)
    game_instance = game.get_game(user_id)

    if user_id not in game_instance["players"]:
        game_instance["players"][user_id] = Player(user_id)
    
    player = game_instance["players"][user_id]

    try:
        player.bet = int(message.text.split(' ')[1])
        if player.bet > 1:
            balance = load_balance(user_id)
            if balance >= player.bet:
                balance -= player.bet
                save_balance(user_id, balance)

                player.is_playing = True
                player.hand = []
                game.deal_initial_cards(game_instance)
                game_instance["current_player"] = player

                bot.send_message(message.chat.id, "–ì—Ä–∞ –≤ –±–ª–µ–∫–¥–∂–µ–∫ –ø–æ—á–∞–ª–∞—Å—è! –¢–≤–æ—ó –∫–∞—Ä—Ç–∏:")
                bot.send_message(message.chat.id, get_hand_string(player.hand))
                bot.send_message(message.chat.id, f"–ó–∞–≥–∞–ª—å–Ω–∞ —Å—É–º–∞: {game.calculate_hand_value(player.hand)}")
                bot.send_message(message.chat.id, "–ö–∞—Ä—Ç–∞ –¥–∏–ª–µ—Ä–∞:")
                bot.send_message(message.chat.id, get_hand_string([game_instance["dealer_hand"][0]]))
                bot.send_message(message.chat.id, "–í–∏–±–µ—Ä–∏, —â–æ —Ä–æ–±–∏—Ç–∏: /hit - –≤–∑—è—Ç–∏ —â–µ –∫–∞—Ä—Ç—É, /stand - –∑–∞–∫—ñ–Ω—á–∏—Ç–∏ —Ö—ñ–¥")
            else:
                bot.send_message(message.chat.id, "–£ –≤–∞—Å –Ω–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ –∫–æ—à—Ç—ñ–≤ –¥–ª—è —Ü—ñ—î—ó —Å—Ç–∞–≤–∫–∏")
        else:
            bot.send_message(message.chat.id, "–°—Ç–∞–≤–∫–∞ –ø–æ–≤–∏–Ω–Ω–∞ –±—É—Ç–∏ –±—ñ–ª—å—à–µ 1 —ñ —Ü—ñ–ª–∏–º —á–∏—Å–ª–æ–º.")
    except (IndexError, ValueError):
        bot.send_message(message.chat.id, "–í–≤–µ–¥—ñ—Ç—å –∫–æ–º–∞–Ω–¥—É —É —Ñ–æ—Ä–º–∞—Ç—ñ /blackjack —Å—É–º–º–∞ (–¥–µ —Å—É–º–º–∞ - —Ü–µ –≤–∞—à–∞ —Å—Ç–∞–≤–∫–∞).")

@bot.message_handler(commands=['hit'])
def hit(message):
    user_id = message.from_user.id

    balance = load_balance(user_id)

    game_instance = game.get_game(user_id)
    if not game_instance:
        bot.send_message(message.chat.id, "–ü–æ—á–Ω—ñ—Ç—å –≥—Ä—É –∫–æ–º–∞–Ω–¥–æ—é /blackjack")
        return

    player = game_instance["players"].get(user_id)

    if not player or not player.is_playing:
        bot.send_message(message.chat.id, "–ü–æ—á–Ω—ñ—Ç—å –≥—Ä—É –∫–æ–º–∞–Ω–¥–æ—é /blackjack")
        return

    card = random.choice(game.deck)
    player.hand.append(card)
    bot.send_message(message.chat.id, f"–¢–∏ –≤–∑—è–≤(–ª–∞) –∫–∞—Ä—Ç—É {card['rank']} {card['suit']}")
    bot.send_message(message.chat.id, get_hand_string(player.hand))
    total_value = game.calculate_hand_value(player.hand)
    bot.send_message(message.chat.id, f"–ó–∞–≥–∞–ª—å–Ω–∞ —Å—É–º–∞: {total_value}")
    if total_value > 21:
        bot.send_message(message.chat.id, "–¢–∏ –ø–µ—Ä–µ–±—Ä–∞–≤(–ª–∞)!")
        bot.send_message(message.chat.id, f"–í–∞—à –ø–æ—Ç–æ—á–Ω–∏–π –±–∞–ª–∞–Ω—Å: {balance}")
        end_game(message)
    else:
        bot.send_message(message.chat.id, "–í–∏–±–µ—Ä–∏, —â–æ —Ä–æ–±–∏—Ç–∏: /hit - –≤–∑—è—Ç–∏ —â–µ –∫–∞—Ä—Ç—É, /stand - –∑–∞–∫—ñ–Ω—á–∏—Ç–∏ —Ö—ñ–¥")

@bot.message_handler(commands=['stand'])
def stand(message):
    user_id = message.from_user.id

    game_instance = game.get_game(user_id)
    if not game_instance:
        bot.send_message(message.chat.id, "–ü–æ—á–Ω—ñ—Ç—å –≥—Ä—É –∫–æ–º–∞–Ω–¥–æ—é /blackjack")
        return

    player = game_instance["players"].get(user_id)

    if not player or not player.is_playing:
        bot.send_message(message.chat.id, "–ü–æ—á–Ω—ñ—Ç—å –≥—Ä—É –∫–æ–º–∞–Ω–¥–æ—é /blackjack")
        return

    game_instance["current_player"] = None
    dealer_total = game.calculate_hand_value(game_instance["dealer_hand"])
    while dealer_total < 17:
        card = random.choice(game.deck)
        game_instance["dealer_hand"].append(card)
        dealer_total = game.calculate_hand_value(game_instance["dealer_hand"])
    bot.send_message(message.chat.id, "–ö–∞—Ä—Ç–∏ –¥–∏–ª–µ—Ä–∞:")
    bot.send_message(message.chat.id, get_hand_string(game_instance["dealer_hand"]))
    bot.send_message(message.chat.id, f"–ó–∞–≥–∞–ª—å–Ω–∞ —Å—É–º–∞ –¥–∏–ª–µ—Ä–∞: {dealer_total}")

    for player in game_instance["players"].values():
        if player.is_playing:
            player_total = game.calculate_hand_value(player.hand)

            random_number = random.choice(possible_values)

            if dealer_total > 21 or (player_total <= 21 and player_total > dealer_total):
                player.current_win += random_number * player.bet
                bot.send_message(message.chat.id, f"–ì—Ä–∞–≤–µ—Ü—å {player.user_id} –ø–µ—Ä–µ–º—ñ–≥! –ë–æ–Ω—É—Å: {random_number}")
                balance = load_balance(player.user_id)
                balance += player.current_win
                save_balance(player.user_id, balance)
                bot.send_message(message.chat.id, f"–í–∞—à –ø–æ—Ç–æ—á–Ω–∏–π –±–∞–ª–∞–Ω—Å: {balance}")

            elif player_total == dealer_total:
                bot.send_message(message.chat.id, f"–ì—Ä–∞–≤–µ—Ü—å {player.user_id} –Ω—ñ—á–∏—è!")
                player.current_win = player.bet
                balance = load_balance(player.user_id)
                balance += player.current_win
                save_balance(player.user_id, balance)
                bot.send_message(message.chat.id, f"–í–∞—à –ø–æ—Ç–æ—á–Ω–∏–π –±–∞–ª–∞–Ω—Å: {balance}")
            else:
                bot.send_message(message.chat.id, f"–ì—Ä–∞–≤–µ—Ü—å {player.user_id} –ø—Ä–æ–≥—Ä–∞–≤.")
                balance = load_balance(player.user_id)
                bot.send_message(message.chat.id, f"–í–∞—à –ø–æ—Ç–æ—á–Ω–∏–π –±–∞–ª–∞–Ω—Å: {balance}")

    
    # –û—á–∏—Å—Ç–∏—Ç–∏ —Ä—É–∫—É —Ç–∞ –æ–±–Ω—É–ª–∏—Ç–∏ current_win –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ –≥—Ä–∞–≤—Ü—è
    for player in game_instance["players"].values():
        player.hand = []
        player.current_win = 0

    end_game(message)

def end_game(message):
    global player_hand, dealer_hand
    game.players = {}
    game.deck = game.get_deck()
    game.dealer_hand = []
    game.current_player = None
    bot.send_message(message.chat.id, "–©–æ–± –ø–æ—á–∞—Ç–∏ –Ω–æ–≤—É –≥—Ä—É, –≤–≤–µ–¥–∏ /blackjack")

def get_hand_string(hand):
    return '\n'.join([f"{card['rank']} {card['suit']}" for card in hand])


# –Ü–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞, —è–∫–∏–π –º–∞—î –ø—Ä–∞–≤–∞ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞

@bot.message_handler(commands=['start'])
def start(message):

    user_id = message.from_user.id
    is_blocked = is_user_blocked(user_id)
    if is_blocked == True:
        bot.send_message(user_id, "–í–∏ –∑–∞–±–ª–æ–∫–æ–≤–∞–Ω—ñ –∑–∞ –ø–æ—Ä—É—à–µ–Ω–Ω—è –ø—Ä–∞–≤–∏–ª —ñ –Ω–µ –º–æ–∂–µ—Ç–µ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—Ç–∏—Å—è –±–æ—Ç–æ–º") 
    else:
        if user_id not in new_users:
            new_users.append(user_id)
        balance = load_balance(user_id)
        if balance == 0:
            balance = 5  # –ü–æ—á–∞—Ç–∫–æ–≤–∏–π –±–∞–ª–∞–Ω—Å 100 –¥–ª—è –Ω–æ–≤–∏—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤
            save_balance(user_id, balance)

        markup = types.ReplyKeyboardMarkup(resize_keyboard=True)
        item_profile = types.KeyboardButton("–û—Å–æ–±–∏—Å—Ç–∏–π –∫–∞–±—ñ–Ω–µ—Ç")
        item_promo_code = types.KeyboardButton("–ü—Ä–æ–º–æ–∫–æ–¥")
        item_available_games = types.KeyboardButton("–Ü–≥—Ä–∏")
        tech_support = types.KeyboardButton("–ó–≤–æ—Ä–æ—Ç–Ω—ñ–π –∑–≤'—è–∑–æ–∫")
        add_balance = types.KeyboardButton("–ü–æ–ø–æ–≤–Ω–∏—Ç–∏ –±–∞–ª–∞–Ω—Å")
        markup.add(item_profile, item_promo_code, item_available_games, tech_support, add_balance)

        # –í—ñ–¥–ø—Ä–∞–≤–ª—è—î–º–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—É –ø—Ä–∏–≤—ñ—Ç–∞–ª—å–Ω–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è —Ä–∞–∑–æ–º —ñ–∑ –∫–Ω–æ–ø–∫–∞–º–∏
        bot.send_message(user_id, "–í—ñ—Ç–∞—é! –í–∏–±–µ—Ä—ñ—Ç—å –æ–¥–Ω—É –∑ –æ–ø—Ü—ñ–π –Ω–∏–∂—á–µ:", reply_markup=markup)

  
        bot.send_message(message.chat.id, f"–î–∞–≤–∞–π—Ç–µ –≥—Ä–∞—Ç–∏ —É –≥—Ä—É!\n\n–í–∞—à –±–∞–ª–∞–Ω—Å: {balance}", reply_markup=markup)

        @bot.message_handler(commands=['start'])
        def start(message):
            bot.send_message(message.chat.id, '–í—ñ—Ç–∞—é! –¶–µ –≤–∞—à –±–æ—Ç.')

        @bot.message_handler(func=lambda message: message.text == "–Ü–≥—Ä–∏")
        def show_games(message):
            user_id = message.from_user.id
            balance = load_balance(user_id)
            # –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ —Ä–µ–∂–∏–º "HTML" –¥–ª—è —Ñ–æ—Ä–º–∞—Ç—É–≤–∞–Ω–Ω—è
            games_list_html = f"<b>–í–∞—à –±–∞–ª–∞–Ω—Å:</b> {balance} UAH\n\n"
            games_list_html += "<b>–î–æ—Å—Ç—É–ø–Ω—ñ —ñ–≥—Ä–∏:</b>\n"
            games_list_html += "–ö—É–±–∏–∫ - /dice <i>—Å—É–º–∞</i>\n"
            games_list_html += "–ë–∞—Å–∫–µ—Ç–±–æ–ª - /basket <i>—Å—É–º–∞</i>\n"
            games_list_html += "–î–∞—Ä—Ç—Å - /darts <i>—Å—É–º–∞</i>\n"
            games_list_html += "–ë–æ–º–±–∏ - /bomb <i>—Å—É–º–∞</i>\n"
            games_list_html += "–ë–ª–µ–∫–î–∂–µ–∫ - /blackjack <i>—Å—É–º–∞</i>\n"
            
            
            # –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ —Ä–µ–∂–∏–º "MarkdownV2" –¥–ª—è —Ñ–æ—Ä–º–∞—Ç—É–≤–∞–Ω–Ω—è
            games_list_markdown = "*–í–∞—à –±–∞–ª–∞–Ω—Å:* " + str(balance) + " UAH\n\n"
            games_list_markdown += "*–î–æ—Å—Ç—É–ø–Ω—ñ —ñ–≥—Ä–∏:*\n"
            games_list_markdown += "–ö—É–±–∏–∫ - /dice _—Å—É–º–∞_\n"
            games_list_markdown += "–ë–∞—Å–∫–µ—Ç–±–æ–ª - /basket _—Å—É–º–∞_\n"
            games_list_markdown += "–î–∞—Ä—Ç—Å - /–î–∞—Ä—Ç—Å _—Å—É–º–∞_\n" 
            games_list_markdown += "–ë–æ–º–±–∏ - /bomb _—Å—É–º–∞_\n"
            games_list_markdown += "–ë–ª–µ–∫–î–∂–µ–∫ - /blackjack _—Å—É–º–∞_\n"
            
            # –í—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –∑ –æ–±–∏–¥–≤–æ–º–∏ –≤–∞—Ä—ñ–∞–Ω—Ç–∞–º–∏ —Ñ–æ—Ä–º–∞—Ç—É–≤–∞–Ω–Ω—è
            bot.send_message(message.chat.id, games_list_html, parse_mode="HTML")
            bot.send_message(message.chat.id, games_list_markdown, parse_mode="MarkdownV2")
            



        @bot.message_handler(commands=['dice'])
        def dice_command(message):
            try:
                user_id = message.from_user.id
                balance = load_balance(user_id)
                bet = int(message.text.split(' ')[1])
                if bet <= balance:
                    balance -= bet
                    save_balance(user_id, balance)
                    dice_message_1 = bot.send_dice(message.chat.id)
                    dice_message_2 = bot.send_dice(message.chat.id)

                    dice_value_1 = dice_message_1.dice.value
                    dice_value_2 = dice_message_2.dice.value

                    time.sleep(3.5)

                    result_message = f"–ü–µ—Ä—à–∏–π –∫—É–±–∏–∫ –ø–æ–∫–∞–∑–∞–≤ —á–∏—Å–ª–æ: {dice_value_1}.\n" \
                                    f"–î—Ä—É–≥–∏–π –∫—É–±–∏–∫ –ø–æ–∫–∞–∑–∞–≤ —á–∏—Å–ª–æ: {dice_value_2}.\n"
                    
                    random_number = random.choice(possible_values)

                    if dice_value_2 > dice_value_1:
                        result_message += f"–í–∏ –≤–∏–≥—Ä–∞–ª–∏ {bet * random_number}! –ë–æ–Ω—É—Å: {random_number}"  
                        balance += bet * random_number
                    elif dice_value_2 < dice_value_1:
                        result_message += "–í–∏ –ø—Ä–æ–≥—Ä–∞–ª–∏."
                    else:
                        result_message += "–ù—ñ—á–∏—è!"
                        balance += bet

                    save_balance(user_id, balance)
                    bot.send_message(message.chat.id, result_message)
                else:
                    bot.send_message(message.chat.id, "–£ –≤–∞—Å –Ω–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ –∫–æ—à—Ç—ñ–≤ –¥–ª—è –≥—Ä–∏.")
            except IndexError:
                bot.send_message(message.chat.id, "–í–≤–µ–¥—ñ—Ç—å –∫–æ–º–∞–Ω–¥—É —É —Ñ–æ—Ä–º–∞—Ç—ñ /dice —Å—É–º–∞")




        @bot.message_handler(commands=['basket'])
        def basket_command(message):
            try:
                user_id = message.from_user.id
                balance = load_balance(user_id)
                bet = int(message.text.split(' ')[1])
                if bet <= balance:
                    balance -= bet
                    save_balance(user_id, balance)

                    dice_message = bot.send_dice(message.chat.id, emoji="üèÄ")
                    dice_value = dice_message.dice.value
                    time.sleep(4)

                    random_number = random.choice(possible_values)


                    if dice_value >= 4:
                        bot.send_message(message.chat.id, f"–í–∏ –≤–∏–≥—Ä–∞–ª–∏ {bet * random_number}! –ú'—è—á –ø–æ–ø–∞–≤ –≤ –∫—ñ–ª—å—Ü–µ. –ë–æ–Ω—É—Å: {random_number}", reply_to_message_id=message.message_id)
                        balance += int(bet * random_number)
                    else: 
                        bot.send_message(message.chat.id, f"–í–∏ –ø—Ä–æ–≥—Ä–∞–ª–∏. –ú'—è—á –Ω–µ –ø–æ–ø–∞–≤.", reply_to_message_id=message.message_id)

                    save_balance(user_id, balance)
                else:
                    bot.send_message(message.chat.id, "–£ –≤–∞—Å –Ω–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ –∫–æ—à—Ç—ñ–≤ –¥–ª—è –≥—Ä–∏.")
            except (IndexError, ValueError):
                bot.send_message(message.chat.id, "–í–≤–µ–¥—ñ—Ç—å –∫–æ–º–∞–Ω–¥—É —É —Ñ–æ—Ä–º–∞—Ç—ñ /basket —Å—É–º–∞")

                

        @bot.message_handler(commands=['darts'])
        def basket_command(message):
            try:
                user_id = message.from_user.id
                balance = load_balance(user_id)
                bet = int(message.text.split(' ')[1])
                if bet <= balance:
                    balance -= bet
                    save_balance(user_id, balance)

                    dice_message = bot.send_dice(message.chat.id, emoji="üéØ")
                    dice_value = dice_message.dice.value
                    time.sleep(6)

                    random_number = random.choice(possible_values)


                    if dice_value >= 6:
                        bot.send_message(message.chat.id, f"–í–∏ –≤–∏–≥—Ä–∞–ª–∏ {bet * random_number}! –î—Ä–æ—Ç–∏–∫ –ø–æ—Ç—Ä–∞–ø–∏–≤ —É —è–±–ª—É—á–∫–æ. –ë–æ–Ω—É—Å: {random_number}", reply_to_message_id=message.message_id)
                        balance += int(bet * random_number)
                    else: 
                        bot.send_message(message.chat.id, f"–í–∏ –ø—Ä–æ–≥—Ä–∞–ª–∏. –î—Ä–æ—Ç–∏–∫ –Ω–µ –ø–æ–ø–∞–≤.", reply_to_message_id=message.message_id)

                    save_balance(user_id, balance)
                else:
                    bot.send_message(message.chat.id, "–£ –≤–∞—Å –Ω–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ –∫–æ—à—Ç—ñ–≤ –¥–ª—è –≥—Ä–∏.")
            except (IndexError, ValueError):
                bot.send_message(message.chat.id, "–í–≤–µ–¥—ñ—Ç—å –∫–æ–º–∞–Ω–¥—É —É —Ñ–æ—Ä–º–∞—Ç—ñ /darts —Å—É–º–∞")




        @bot.message_handler(func=lambda message: message.text == "–û—Å–æ–±–∏—Å—Ç–∏–π –∫–∞–±—ñ–Ω–µ—Ç")
        def profile(message):
            user_id = message.from_user.id
            balance = load_balance(user_id)

            # –û—Ç—Ä–∏–º–∞–Ω–Ω—è —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –ø—Ä–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
            user_info = bot.get_user_profile_photos(user_id).photos
            user_avatar = None
            if user_info:
                user_avatar = user_info[0][-1].file_id

            user_id_message = f"–Ü–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞: {user_id}"
            user_balance_message = f"–í–∞—à –±–∞–ª–∞–Ω—Å: {balance}"

            # –í—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–Ω—è —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –ø—Ä–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –∑ –∞–≤–∞—Ç–∞—Ä–∫–æ—é
            if user_avatar:
                bot.send_photo(message.chat.id, user_avatar, caption=user_id_message + "\n" + user_balance_message)
            else:
                bot.send_message(message.chat.id, user_id_message + "\n" + user_balance_message)



        @bot.message_handler(func=lambda message: message.text == "–ü—Ä–æ–º–æ–∫–æ–¥")
        def enter_promo_code(message):
            user_id = message.from_user.id
            
            bot.send_message(user_id, "–í–≤–µ–¥—ñ—Ç—å –ø—Ä–æ–º–æ–∫–æ–¥:")
            bot.register_next_step_handler(message, process_promo_code)
           
        def process_promo_code(message):
            user_id = message.from_user.id
            promo_code = message.text

            if promo_code in promo_codes:
                amount = promo_codes[promo_code]
                current_balance = load_balance(user_id)
                save_balance(user_id, current_balance + amount)
                bot.send_message(user_id, f"–í–∞—à –±–∞–ª–∞–Ω—Å –∑–±—ñ–ª—å—à–µ–Ω–æ –Ω–∞ {amount}.")
            else:
                bot.send_message(user_id, "–ù–µ–¥—ñ–π—Å–Ω–∏–π –ø—Ä–æ–º–æ–∫–æ–¥. –°–ø—Ä–æ–±—É–π—Ç–µ —â–µ —Ä–∞–∑ –∞–±–æ –∑–≤–µ—Ä–Ω—ñ—Ç—å—Å—è –¥–æ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞.")

        user_context = {}


        # –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –æ–±—Ä–æ–±–∫–∏ –∫–Ω–æ–ø–∫–∏ "–ù–∞–ø–∏—Å–∞—Ç–∏ –∞–¥–º—ñ–Ω—É"
        @bot.message_handler(func=lambda message: message.text == "–ó–≤–æ—Ä–æ—Ç–Ω—ñ–π –∑–≤'—è–∑–æ–∫")
        def send_message_to_admin(message):
            user_id = message.chat.id
            user_context[user_id] = message.text
            bot.send_message(user_id, "–í–≤–µ–¥—ñ—Ç—å –≤–∞—à–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è:")
            bot.register_next_step_handler(message, forward_message_to_admin)

        # –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –ø–µ—Ä–µ—Å–∏–ª–∞–Ω–Ω—è –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –∞–¥–º—ñ–Ω—É
        def forward_message_to_admin(message):
            user_id = message.chat.id
            if user_id in user_context:
                for admin_id in ADMIN_USER_IDS:
                    bot.send_message(admin_id, f'–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –≤—ñ–¥ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ {user_id}:\n\n{message.text}')
                bot.send_message(user_id, '–í–∞—à–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –Ω–∞–¥—ñ—Å–ª–∞–Ω–æ –∞–¥–º—ñ–Ω—É, –æ—á—ñ–∫—É–π—Ç–µ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ!')
                del user_context[user_id]
            else:
                bot.send_message(user_id, "–°–ø–æ—á–∞—Ç–∫—É –Ω–∞—Ç–∏—Å–Ω—ñ—Ç—å –∫–Ω–æ–ø–∫—É '–ù–∞–ø–∏—Å–∞—Ç–∏ –∞–¥–º—ñ–Ω—É'.")

             
        

        def handle_inline_callbacks(call):
            chat_id = call.message.chat.id
            message_id = call.message.message_id

            if call.data.startswith("confirm_"):
                # –û—Ç—Ä–∏–º–∞–Ω–æ –∑–∞–ø–∏—Ç –Ω–∞ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è –≤—ñ–¥ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞
                user_id = int(call.data.split("_")[1])

                if user_id in user_balance_data:
                    # –ó–∞—Ä–∞—Ö—É–≤–∞–Ω–Ω—è –≥—Ä–æ—à–µ–π –Ω–∞ —Ä–∞—Ö—É–Ω–æ–∫ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
                    balance = load_balance(user_id)
                    balance += user_balance_data[user_id]['amount']
                    save_balance(user_id, balance)

                    # –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—É –ø—Ä–æ —É—Å–ø—ñ—à–Ω—É –æ–ø–µ—Ä–∞—Ü—ñ—é
                    success_message = f"–í–∞—à –±–∞–ª–∞–Ω—Å –±—É–ª–æ –ø–æ–ø–æ–≤–Ω–µ–Ω–æ –Ω–∞ {user_balance_data[user_id]['amount']} –≥—Ä–Ω. –û–ø–µ—Ä–∞—Ü—ñ—è —É—Å–ø—ñ—à–Ω–æ –≤–∏–∫–æ–Ω–∞–Ω–∞!"
                    bot.send_message(user_id, success_message)

                    # –í–∏–¥–∞–ª–µ–Ω–Ω—è –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞ —ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è
                    bot.delete_message(user_id, message_id)
                    bot.send_message(user_id, "–û–ø–µ—Ä–∞—Ü—ñ—é –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–æ!")

                    # –í–∏–¥–∞–ª–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –∑ —Å–ª–æ–≤–Ω–∏–∫–∞
                    del user_balance_data[user_id]
                else:
                    bot.send_message(chat_id, "–ü–æ–º–∏–ª–∫–∞: –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ –≤ –±–∞–∑—ñ –¥–∞–Ω–∏—Ö.")

        # –û–±—Ä–æ–±–Ω–∏–∫ –∫–æ–º–∞–Ω–¥–∏ "–ü–æ–ø–æ–≤–Ω–∏—Ç–∏ –±–∞–ª–∞–Ω—Å"
        @bot.message_handler(func=lambda message: message.text == "–ü–æ–ø–æ–≤–Ω–∏—Ç–∏ –±–∞–ª–∞–Ω—Å")
        def handle_top_up_balance(message):
            chat_id = message.chat.id

            user_balance_data[chat_id] = {}  # –°—Ç–≤–æ—Ä—é—î–º–æ –∑–∞–ø–∏—Å –¥–ª—è –ø–æ—Ç–æ—á–Ω–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
            user_balance_data[chat_id]['step'] = 1  # –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ –µ—Ç–∞–ø –Ω–∞ 1 (–∑–∞–ø–∏—Ç —Å—É–º–∏ –ø–æ–ø–æ–≤–Ω–µ–Ω–Ω—è)
            user_balance_data[chat_id]['attempts'] = 3  # –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑—É—î–º–æ —Å–ø—Ä–æ–±–∏ –¥–ª—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞

            # –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ –ø–æ—á–∞—Ç–∫–æ–≤—ñ —Ä–µ–∫–≤—ñ–∑–∏—Ç–∏
            user_balance_data[chat_id]['details'] = "4149 4991 4773 2411 1"

            bot.send_message(chat_id, "–°–∫—ñ–ª—å–∫–∏ –≥—Ä–æ—à–µ–π –≤–∏ –±–∞–∂–∞—î—Ç–µ –ø–æ–ø–æ–≤–Ω–∏—Ç–∏?")

        # –û–±—Ä–æ–±–Ω–∏–∫ –≤—Å—ñ—Ö —Ç–µ–∫—Å—Ç–æ–≤–∏—Ö –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å
        @bot.message_handler(func=lambda message: True)
        def handle_messages(message):
            chat_id = message.chat.id

            if chat_id in user_balance_data and 'step' in user_balance_data[chat_id]:
                if user_balance_data[chat_id]['step'] == 1:
                    if user_balance_data[chat_id]['attempts'] > 0:
                        try:
                            amount = float(message.text)
                            user_balance_data[chat_id]['amount'] = amount
                            user_balance_data[chat_id]['step'] = 2  # –ü–µ—Ä–µ—Ö–æ–¥–∏–º–æ –Ω–∞ –Ω–∞—Å—Ç—É–ø–Ω–∏–π –µ—Ç–∞–ø (–∑–∞–ø–∏—Ç —Ä–µ–∫–≤—ñ–∑–∏—Ç—ñ–≤)
                            bot.send_message(chat_id, "–ë—É–¥—å –ª–∞—Å–∫–∞, –≤–≤–µ–¥—ñ—Ç—å —Ä–µ–∫–≤—ñ–∑–∏—Ç–∏ –Ω–∞ —è–∫—ñ –Ω–∞—Ä–∞—Ö—É—é—Ç—å—Å—è –≥—Ä–æ—à—ñ —É —Ä–∞–∑—ñ –≤–∏–≥—Ä–∞—à—É. –î–ª—è —Ç–æ–≥–æ —â–æ–± –æ—Ç—Ä–∏–º–∞—Ç–∏ –≤–Ω—É—Ç—Ä—ñ—à–Ω—å–æ—ñ–≥—Ä–æ–≤—É –≤–∞–ª—é—Ç—É –∑–∞–∫–∏–Ω—å—Ç–µ –≥—Ä–æ—à—ñ –∑–∞ —Ä–µ–∫–≤—ñ–∑–∏—Ç–æ–º: 4441 1111 3329 3112")
                        except ValueError:
                            user_balance_data[chat_id]['attempts'] -= 1
                            bot.send_message(chat_id, f"–ë—É–¥—å –ª–∞—Å–∫–∞, –≤–≤–µ–¥—ñ—Ç—å –∫–æ—Ä–µ–∫—Ç–Ω—É —Å—É–º—É. –ó–∞–ª–∏—à–∏–ª–æ—Å—å —Å–ø—Ä–æ–±: {user_balance_data[chat_id]['attempts']}")
                    else:
                        bot.send_message(chat_id, "–í–∏ –≤–∏—á–µ—Ä–ø–∞–ª–∏ –≤—Å—ñ —Å–ø—Ä–æ–±–∏. –û–ø–µ—Ä–∞—Ü—ñ—è –ø–æ–ø–æ–≤–Ω–µ–Ω–Ω—è –±–∞–ª–∞–Ω—Å—É —Ç–µ—Ä–º—ñ–Ω—É—î—Ç—å—Å—è.")
                        del user_balance_data[chat_id]  # –í–∏–¥–∞–ª–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞

                elif user_balance_data[chat_id]['step'] == 2:
                    user_balance_data[chat_id]['details'] = message.text
                    user_balance_data[chat_id]['step'] = 3  # –ü–µ—Ä–µ—Ö–æ–¥–∏–º–æ –Ω–∞ –Ω–∞—Å—Ç—É–ø–Ω–∏–π –µ—Ç–∞–ø (–≤—ñ–¥–ø—Ä–∞–≤–∫–∞ –∑–∞–ø–∏—Ç—É –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º)

                    # –ì–µ–Ω–µ—Ä—É—î–º–æ –Ω–æ–º–µ—Ä —á–µ–∫—É
                    receipt_number = ''.join(random.choices(string.digits, k=6))
                    current_time = time.strftime('%Y-%m-%d %H:%M:%S')

                    # –í—ñ–¥–ø—Ä–∞–≤–∫–∞ –∑–∞–ø–∏—Ç—É –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º –∑ —ñ–Ω–ª–∞–π–Ω-–∫–Ω–æ–ø–∫–æ—é "–ü—ñ–¥—Ç–≤–µ—Ä–¥–∏—Ç–∏"
                    inline_keyboard = telebot.types.InlineKeyboardMarkup()
                    confirm_button = telebot.types.InlineKeyboardButton("–ü—ñ–¥—Ç–≤–µ—Ä–¥–∏—Ç–∏", callback_data=f"confirm_{chat_id}")
                    inline_keyboard.add(confirm_button)

                    # –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –¥–ª—è –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä—ñ–≤
                    for admin_id in ADMIN_USER_IDS:
                        admin_message = f"–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á {chat_id} –±–∞–∂–∞—î –ø–æ–ø–æ–≤–Ω–∏—Ç–∏ –±–∞–ª–∞–Ω—Å –Ω–∞ —Å—É–º—É {user_balance_data[chat_id]['amount']} –≥—Ä–Ω. –†–µ–∫–≤—ñ–∑–∏—Ç–∏: {user_balance_data[chat_id]['details']}\n"
                        admin_message += f"–ß–∞—Å: {current_time}\n–ù–æ–º–µ—Ä —á–µ–∫—É: {receipt_number}"

                        bot.send_message(admin_id, admin_message, reply_markup=inline_keyboard)

                    bot.send_message(chat_id, "–ó–∞–ø–∏—Ç –Ω–∞ –ø–æ–ø–æ–≤–Ω–µ–Ω–Ω—è –±–∞–ª–∞–Ω—Å—É –±—É–ª–æ –Ω–∞–¥—ñ—Å–ª–∞–Ω–æ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º. –ë—É–¥—å –ª–∞—Å–∫–∞, –∑–∞—á–µ–∫–∞–π—Ç–µ –Ω–∞ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è.")

        # –Ü–Ω—à—ñ —Ñ—É–Ω–∫—Ü—ñ—ó –≤–∞—à–æ–≥–æ –±–æ—Ç–∞

        # –û–±—Ä–æ–±–Ω–∏–∫ —ñ–Ω–ª–∞–π–Ω-–∑–∞–ø–∏—Ç—ñ–≤
        @bot.callback_query_handler(func=lambda call: True)
        def handle_inline_queries(call):
            handle_inline_callbacks(call)

if __name__ == '__main__':
    bot.polling(none_stop=True)


if __name__ == '__main__':
    bot.polling(none_stop=True)
